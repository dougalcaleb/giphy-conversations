<app-header></app-header>
<div class="page">
	<app-chat-list></app-chat-list>
	<div class="wrap">
		<div class="info">
			<h1>Conversation 1</h1>
			<p (click)="toggleModal()">i</p>
		</div>
		<div class="messages" id="messages" #messageWrapper>

         <!-- Load more messages button at top -->
         <div class="full-size load-more-messages" (click)="loadMoreMessages()">Load more messages</div>

         <!-- All messages -->
			<div *ngFor="let message of messages" class="message-wrap {{message.type}}">
				<div class="user" style="background-image: url({{message.senderPhotoURL}})"></div>
				<div class="gif" *ngIf="message.senderName != 'GIPHY_CONVERSATIONS_NOTIFICATIONS'">
               <mat-progress-spinner mode="indeterminate" diameter="50" color="primary" class="video-loader"></mat-progress-spinner>
               <video autoplay loop disablePictureInPicture disableRemotePlayback muted="true" preload="auto" src="{{message.url}}">Your browser does not support embedded video.</video>
					<div class="imginfo">
						<p>{{message.time}} from {{message.senderName}}</p>
						<img src="{{ message.heart }}" class="heart" (click)="heartToggle(message.url)" />
					</div>
				</div>
            <p class="notification-text" *ngIf="message.senderName == 'GIPHY_CONVERSATIONS_NOTIFICATIONS'">{{message.user}} left the chat {{message.time | lowercase}}</p>
			</div>

		</div>

      <!-- Input and buttons area -->

		<div class="send">
			<input type="text" placeholder="Search for a GIF" [(ngModel)]="searchTerm" (keydown)="search($event)"/>
			<button class="favorites" (click)="openFavorites()"><img src="assets/heart.png"></button>
			<button class="cancelPicker" (click)="cancelGifPicker()">Cancel</button>
			
			<div class="gradient"></div>

         <div class="closeGifPicker" (click)="closeGifPicker()" *ngIf="retrieved"></div>

         <!-- Dynamic GIF picker -->
         <div class="gifs" *ngIf="retrieved">
            <div class="exitGifPicker" (click)="closeGifPicker()"></div>
            <span *ngFor="let gif of searchResult;" (click)="selectGif(gif.images.original.mp4)">
               <video autoplay loop disablePictureInPicture disableRemotePlayback muted="true" preload="auto" src={{gif.images.fixed_height.mp4}}></video>
               <div class="spinner-wrap">
                  <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
               </div>
            </span>
            <span class="load-more" (click)="loadMore()">
               <svg viewBox="0 0 24 24">
                  <path fill="currentColor" d="M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M13,7H11V11H7V13H11V17H13V13H17V11H13V7Z" />
              </svg>
              <p>Load More</p>
            </span>
         </div>

         <!-- Favorite GIF picker -->
         <div class="gifs-favorite" *ngIf="choosingFavorite">
            <div class="exitFavoritePicker" (click)="closeFavorites()"></div>
            <span *ngFor="let gif of Store.activeUser_Firebase.favoritedGifs;" (click)="selectGif(gif)">
               <video autoplay loop disablePictureInPicture disableRemotePlayback muted="true" preload="auto" src={{gif}}></video>
               <img src="assets/heart.png" class="unfavorite-gif" (click)="heartToggle(gif)" title="Unfavorite this GIF">
               <div class="spinner-wrap">
                  <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
               </div>
            </span>
            <span class="no-favorites" *ngIf="Store.activeUser_Firebase.favoritedGifs.length == 0">
              <p>No favorited GIFs</p>
            </span>
         </div>

         <!-- Autoscroll button -->
         <div class="scrollToBottom" title="Scroll to bottom" (click)="scrollToBottom()" *ngIf="!scrolled">
            <svg viewBox="0 0 24 24">
               <path fill="currentColor" d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" />
           </svg>
         </div>

		</div>

      

	</div>
	<!-- <app-test-chatlist></app-test-chatlist> -->
</div>
